<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style type="text/css">
	[ng\:cloak], [ng-cloak], .ng-cloak {
	  display: none !important;
	}
	.weather-feed {
		width:400px;
	}
	</style>
</head>
<body ng-app="ngAPI">
<div class="weather-feed" ng-controller="APIController" ng-cloak>

<input ng-model="city" type="text">
<button ng-click="getWeather(city)">Check the weather in {{city}}</button>

<!-- CITY NAME -->
<h1>{{api.request[0].query}}</h1>
<!-- MAIN ICON -->
<img ng-src="{{api.current_condition[0].weatherIconUrl[0].value}}"
     style="float:left;padding-right:8px;">
	
	Today {{getDay(date.getDay())}}<br>
	<h3>{{api.current_condition[0].temp_C}}&#176;C / 
	    {{api.current_condition[0].temp_F}}&#176;F</h3><br>

    <img ng-src="{{api.weather[1].weatherIconUrl[0].value}}" style="width:6%;">
	Tomorrow, {{days[1].name}}<br>
	{{days[1].c}}&#176;C / 
	{{days[1].f}}&#176;F<br><br> 
	
	<div ng-repeat="i in range(number) track by $index">
		<img ng-src="{{api.weather[$index].weatherIconUrl[0].value}}" 
		     style="width:6%;">
		{{days[$index+2].c}}&#176;C / 
		{{days[$index+2].f}}&#176;F
		{{days[$index+2].name}}<br>
		<span ng-hide="true">{{$index+1}}</span>
	</div>

</div>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.19/angular.min.js"></script>
<script>
var ngAPI = angular.module('ngAPI', []);

ngAPI.controller('APIController', function ($scope, $http) {
	$scope.date = new Date();
	
 	$scope.city = 'Toronto';
 	$scope.getWeather = function (city) {
	  	$http
	  	.get('https://api.worldweatheronline.com/free/v1/weather.ashx?q=' 
	  		+ $scope.city + 
	  		'&format=json&num_of_days=5&key=707a8a94e3eb000ed78b12dff3007be26732de7c')
	  	.success(function(api) {
	  	$scope.days = [];
	  	for (var i=1;i<5;i++) {
	  		$scope.days[i] = {
	  			name: $scope.getDay($scope.date.getDay()+i),
	  			c: Math.floor(avgTemp(
		  				api.data.weather[i].tempMinC, 
		  				api.data.weather[i].tempMaxC)),
	  			f: Math.floor(avgTemp(
				  		api.data.weather[i].tempMinF, 
				  		api.data.weather[i].tempMaxF))
	  		}
	  	}
	    $scope.api = api.data;
	    });
	}
	$scope.getWeather($scope.city);

	//UTILITY
	$scope.number = 3;
	$scope.range = function(num) {
	    return new Array(num);   
	};

	function avgTemp (min, max) {
		min = parseInt(min);
		max = parseInt(max);
		return ((min + max) / 2) + 1;
	}

	$scope.getDay = function (number) {
		if (number == 0 || 
			number == 7) { return 'Sunday'; }
		if (number == 1 ||
			number == 8) { return 'Monday'; }
		if (number == 2 ||
			number == 9) { return 'Tuesday'; }
		if (number == 3 ||
			number == 10) { return 'Wednesday'; }
		if (number == 4) { return 'Thursday'; }
		if (number == 5) { return 'Friday'; }
		if (number == 6) { return 'Saturday'; }
	}
});

</script>
</body>
</html>